(function($) {

    var scope = $('#campaign-user-selection'),
        form = $('form', scope),
        aBlocks = $('.action-block', scope),
        confirmation = $('#submit-confirmation');

    aBlocks.on('touchstart', function(e) {
        $(this).toggleClass('active');
    });

    // Prevent default form submission
    form.on('submit', function(e) {
        e.preventDefault();
    });

    // Custom form submission based on user action
    $('button[data-campaign]', form).on('click', function(e) {

        var self = $(this),
            imageCSS = self.closest('.action-block').css('background-image');

        if(imageCSS) {
            //var imageURL = imageCSS.replace(/^url\(|\)$/ig, '');
            confirmation.children('.modal-dialog').css('background-image', imageCSS);
        }

        $('input[name="campaign"]', form).val(self.data('campaign'));
        $('input[name="title"]', form).val(display_name + "'s Campaign For "+self.data('campaign-title'));
    });

    $('button[data-type]', confirmation).on('click', function(e) {
        var self = $(this);

        confirmation.modal('hide');
        $('input[name="type"]', form).val(self.data('type'));
        submitForm();
    });

    function submitForm() {
        $.post(
            home_url+'wp-admin/admin-ajax.php',
            form.serialize(),
            function(response) {
                window.location = home_url+"setup-campaign/?campaign="+response.campaignId;
            },
            'json'
        );
    }

    function viewport() {
        var e = window, a = 'inner';
        if (!('innerWidth' in window )) {
            a = 'client';
            e = document.documentElement || document.body;
        }
        return { width : e[ a+'Width' ] , height : e[ a+'Height' ] };
    }

})(jQuery);